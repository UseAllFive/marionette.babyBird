!function(a){"function"==typeof define&&define.amd?define(["backbone","marionette","underscore","underscore.string"],a):a(Backbone,Marionette,_,_s)}(function(a,b,c,d){function e(a){function b(a,b){return j+b}return c.each(a,function(g,j){var k,l;if("object"==typeof g)a[j]=e(g);else if("string"==typeof g){if(k=f(g),g=k.string,g.split(/ /).length>i){for(l=0;h-1>l;l+=1)g=g.replace(/ ([^ ]+)$/,b);a[j]=g}c.each(k.positions,function(b){a[j]=d.splice(a[j],b.index,b.string.length,b.string)})}}),a}function f(a){var b,c,e,f,g;if(g={string:a,positions:[]},-1===a.indexOf("<a"))return g;for(c=a.match(/(<a.*?<\/a>)/g);c.length>0;)b=c.shift(),e=a.indexOf(b),f=d.repeat("_",b.length),a=d.splice(a,e,b.length,f),g.positions.push({index:e,string:b});return g.string=a,g}var g,h=2,i=10,j=String.fromCharCode(160),k=b.Renderer.render;return b.Renderer.render=function(a,b,c){try{var d;if(!a)return;return d=g.call(c,b),d=e(d),k.call(this,a,d)}catch(f){return console.error(f),k.apply(this,arguments)}},b.View.prototype.serializeModel&&(b.View.prototype.serializeModel=function(a){return g(a.attributes)}),g=function l(b){var d;return b instanceof a.Collection?(c.each(b.models,function(a,c){b.models[c]=l.call(this,a)},this),b=b.models):b instanceof a.Model?(d=b.id,c.each(b.attributes,function(a,c){b.attributes[c]=l.call(this,a)},this),b=b.attributes,b.id=d):b=c.clone(b),c.each(b,function(a,d){c.isFunction(a)?b[d]=a.call(this):"object"==typeof a&&(b[d]=l.call(this,a))},this),b},b});